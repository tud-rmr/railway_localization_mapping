function [z_hat,H] = simFcn_Imm_Circle_MeasurementFcn(x_hat,z,u,sample_time)

if sign(x_hat(4)) >= 0

    H = [  1, 0, 0, 0, 0, 0, 0; ... 
           0, 1, 0, 0, 0, 0, 0; ... 
           0, 0, 0, 1, 0, 0, 0; ...
           0, 0, 0, 0, 0, 1, 0; ...
           0, 0, 0, 0, 1, 0, 0; ...
           0, 0, 0, 0, 0, 0, 1  ...
        ];
    
%     H = [  1, 0, 0, 0, 0, 0, 0; ... 
%            0, 1, 0, 0, 0, 0, 0; ... 
%            0, 0, 0, 1, 0, 0, 0; ...
%            0, 0, 0, 0, 0, 1, 0 ...
%         ];

    z_hat = H*x_hat;
    
else
    
    H = [  1, 0, 0,  0, 0, 0, 0; ... 
           0, 1, 0,  0, 0, 0, 0; ... 
           0, 0, 0, -1, 0, 0, 0; ...
           0, 0, 0,  0, 0, 1, 0; ...
           0, 0, 0,  0, 1, 0, 0; ...
           0, 0, 0,  0, 0, 0, 1  ...
        ];
    
%     H = [  1, 0, 0,  0, 0, 0, 0; ... 
%            0, 1, 0,  0, 0, 0, 0; ... 
%            0, 0, 0, -1, 0, 0, 0; ...
%            0, 0, 0,  0, 0, 1, 0 ...
%         ];

    z_hat = [ ...
              x_hat(1); ... 
              x_hat(2); ... 
              -x_hat(4); ... 
              x_hat(6)-pi; ... 
              x_hat(5); ... 
              x_hat(7)  ...
            ];
              
    
end % if



end % end function



